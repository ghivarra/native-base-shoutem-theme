{"version":3,"sources":["../../src/connectStyle.js"],"names":["clearThemeCache","_","themeCache","throwConnectStyleError","errorMessage","componentDisplayName","Error","isStyleVariant","propertyName","test","isChildStyle","getConcreteStyle","style","pickBy","value","key","componentStyleName","componentStyle","mapPropsToStyleNames","options","getComponentDisplayName","WrappedComponent","displayName","name","wrapWithStyledComponent","isPlainObject","isString","StyledComponent","props","styleNames","getStyleNames","buildStyle","state","addedProps","resolveAddedProps","setWrappedInstance","bind","StyleContext","_currentValue","Theme","getDefaultTheme","names","map","remove","v","theme","getTheme","themeStyle","createComponentStyle","resolvedStyle","concreteStyle","merge","isArray","prevProps","prevState","nextStyleNames","propsChanged","styleName","styleNamesChanged","isEqual","nextStyle","setState","withRef","ref","component","wrappedInstance","_root","React","PureComponent","propTypes","PropTypes","oneOfType","object","number","array","string","virtual","bool","defaultProps"],"mappings":"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","file":"connectStyle.js","sourcesContent":["/* eslint-disable react/forbid-prop-types */\nimport React from \"react\";\nimport PropTypes from \"prop-types\";\nimport hoistStatics from \"hoist-non-react-statics\";\nimport * as _ from \"lodash\";\nimport normalizeStyle from \"./StyleNormalizer/normalizeStyle\";\nimport { StyleSheet } from \"react-native\";\n\nimport Theme, { ThemeShape } from \"./Theme\";\nimport { resolveComponentStyle } from \"./resolveComponentStyle\";\nimport { StyleContext } from \"./StyleProvider\";\n\nlet themeCache = {};\n\nexport function clearThemeCache() {\n  themeCache = {};\n}\n\nfunction throwConnectStyleError(errorMessage, componentDisplayName) {\n  throw Error(\n    `${errorMessage} - when connecting ${componentDisplayName} component to style.`\n  );\n}\n\nfunction isStyleVariant(propertyName) {\n  return /^\\./.test(propertyName);\n}\n\nfunction isChildStyle(propertyName) {\n  return /(^[^\\.].*\\.)|^\\*$/.test(propertyName);\n}\n\nfunction getConcreteStyle(style) {\n  return _.pickBy(style, (value, key) => {\n    return !isStyleVariant(key) && !isChildStyle(key);\n  });\n}\n\nexport default (\n  componentStyleName,\n  componentStyle = {},\n  mapPropsToStyleNames,\n  options = {}\n) => {\n  function getComponentDisplayName(WrappedComponent) {\n    return WrappedComponent.displayName || WrappedComponent.name || \"Component\";\n  }\n\n  return function wrapWithStyledComponent(WrappedComponent) {\n    const componentDisplayName = getComponentDisplayName(WrappedComponent);\n\n    if (!_.isPlainObject(componentStyle)) {\n      throwConnectStyleError(\n        \"Component style must be plain object\",\n        componentDisplayName\n      );\n    }\n\n    if (!_.isString(componentStyleName)) {\n      throwConnectStyleError(\n        \"Component Style Name must be string\",\n        componentDisplayName\n      );\n    }\n\n    class StyledComponent extends React.PureComponent {\n      static propTypes = {\n        style: PropTypes.oneOfType([\n          PropTypes.object,\n          PropTypes.number,\n          PropTypes.array\n        ]),\n        styleName: PropTypes.string,\n        virtual: PropTypes.bool\n      };\n\n      static defaultProps = {\n        virtual: options.virtual\n      };\n\n      static displayName = `Styled(${componentDisplayName})`;\n      static WrappedComponent = WrappedComponent;\n\n      constructor(props) {\n        super(props);\n\n        const styleNames = this.getStyleNames(props);\n        const style = this.buildStyle(props, styleNames);\n\n        this.state = {\n          style,\n          styleNames,\n          addedProps: this.resolveAddedProps()\n        };\n\n        this.setWrappedInstance = this.setWrappedInstance.bind(this);\n      }\n\n      getTheme() {\n        return (\n          StyleContext._currentValue ||\n          Theme.getDefaultTheme()\n        );\n      }\n\n      getStyleNames(props) {\n        const names = _.map(props, (value, key) => {\n          if (typeof value !== \"object\" && value === true) {\n            return \".\" + key;\n          }\n          return false;\n        });\n\n        _.remove(names, v => v === false);\n        return names;\n      }\n\n      buildStyle(props, styleNames) {\n        const theme = this.getTheme();\n\n        const themeStyle = theme.createComponentStyle(\n          componentStyleName,\n          componentStyle\n        );\n\n        const resolvedStyle = resolveComponentStyle(\n          componentStyleName,\n          styleNames,\n          themeStyle,\n          {}\n        );\n\n        themeCache[componentStyleName] = resolvedStyle;\n\n        const concreteStyle = getConcreteStyle(\n          _.merge({}, resolvedStyle)\n        );\n\n        if (_.isArray(props.style)) {\n          return [concreteStyle, ...props.style];\n        }\n\n        if (\n          typeof props.style === \"number\" ||\n          typeof props.style === \"object\"\n        ) {\n          return [concreteStyle, props.style];\n        }\n\n        return concreteStyle;\n      }\n\n      componentDidUpdate(prevProps, prevState) {\n        const nextStyleNames = this.getStyleNames(this.props);\n\n        const propsChanged =\n          prevProps.style !== this.props.style ||\n          prevProps.styleName !== this.props.styleName;\n\n        const styleNamesChanged = !_.isEqual(\n          prevState.styleNames,\n          nextStyleNames\n        );\n\n        if (!propsChanged && !styleNamesChanged) return;\n\n        const nextStyle = this.buildStyle(\n          this.props,\n          nextStyleNames\n        );\n\n        if (!_.isEqual(prevState.style, nextStyle)) {\n          this.setState({\n            style: nextStyle,\n            styleNames: nextStyleNames\n          });\n        }\n      }\n\n      resolveAddedProps() {\n        if (options.withRef) {\n          return { ref: \"wrappedInstance\" };\n        }\n        return {};\n      }\n\n      setWrappedInstance(component) {\n        this.wrappedInstance =\n          component && component._root\n            ? component._root\n            : component;\n      }\n\n      render() {\n        const { addedProps, style } = this.state;\n\n        return (\n          <WrappedComponent\n            {...this.props}\n            {...addedProps}\n            style={style}\n            ref={this.setWrappedInstance}\n          />\n        );\n      }\n    }\n\n    return hoistStatics(StyledComponent, WrappedComponent);\n  };\n};"]}