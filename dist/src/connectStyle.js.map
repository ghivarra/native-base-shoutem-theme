{"version":3,"sources":["../../src/connectStyle.js"],"names":["clearThemeCache","_","themeCache","isStyleVariant","propertyName","test","isChildStyle","getConcreteStyle","style","pickBy","value","key","componentStyleName","componentStyle","mapPropsToStyleNames","options","StyledCore","props","styleNames","getStyleNames","buildStyle","state","names","map","remove","v","theme","__theme","Theme","getDefaultTheme","themeStyle","createComponentStyle","resolvedStyle","concreteStyle","merge","isArray","prevProps","nextStyleNames","isEqual","setState","forwardedRef","rest","refSent","withRef","React","PureComponent","propTypes","PropTypes","oneOfType","object","number","array","styleName","string","virtual","bool","any","defaultProps","StyledWithTheme","forwardRef","ref","displayName","WrappedComponent","name"],"mappings":"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","file":"connectStyle.js","sourcesContent":["import React from \"react\";\nimport PropTypes from \"prop-types\";\nimport hoistStatics from \"hoist-non-react-statics\";\nimport * as _ from \"lodash\";\n\nimport Theme from \"./Theme\";\nimport { resolveComponentStyle } from \"./resolveComponentStyle\";\nimport { StyleContext } from './StyleProviderContext';\n\nlet themeCache = {};\n\nexport function clearThemeCache() {\n  themeCache = {};\n}\n\nfunction isStyleVariant(propertyName) {\n  return /^\\./.test(propertyName);\n}\n\nfunction isChildStyle(propertyName) {\n  return /(^[^\\.].*\\.)|^\\*$/.test(propertyName);\n}\n\nfunction getConcreteStyle(style) {\n  return _.pickBy(style, (value, key) => {\n    return !isStyleVariant(key) && !isChildStyle(key);\n  });\n}\n\nexport default (\n  componentStyleName,\n  componentStyle = {},\n  mapPropsToStyleNames,\n  options = {}\n) => WrappedComponent => {\n  class StyledCore extends React.PureComponent {\n    static propTypes = {\n      style: PropTypes.oneOfType([\n        PropTypes.object,\n        PropTypes.number,\n        PropTypes.array\n      ]),\n      styleName: PropTypes.string,\n      virtual: PropTypes.bool,\n      __theme: PropTypes.object,\n      forwardedRef: PropTypes.any\n    };\n\n    static defaultProps = {\n      virtual: options.virtual\n    };\n\n    constructor(props) {\n      super(props);\n      const styleNames = this.getStyleNames(props);\n      const style = this.buildStyle(props, styleNames);\n\n      this.state = {\n        style,\n        styleNames\n      };\n    }\n\n    getStyleNames(props) {\n      const names = _.map(props, (value, key) =>\n        typeof value !== \"object\" && value === true ? \".\" + key : false\n      );\n      _.remove(names, v => v === false);\n      return names;\n    }\n\n    buildStyle(props, styleNames) {\n      const theme = props.__theme || Theme.getDefaultTheme();\n\n      const themeStyle = theme.createComponentStyle(\n        componentStyleName,\n        componentStyle\n      );\n\n      const resolvedStyle = resolveComponentStyle(\n        componentStyleName,\n        styleNames,\n        themeStyle,\n        {}\n      );\n\n      const concreteStyle = getConcreteStyle(\n        _.merge({}, resolvedStyle)\n      );\n\n      if (_.isArray(props.style)) {\n        return [concreteStyle, ...props.style];\n      }\n\n      if (\n        typeof props.style === \"number\" ||\n        typeof props.style === \"object\"\n      ) {\n        return [concreteStyle, props.style];\n      }\n\n      return concreteStyle;\n    }\n\n    componentDidUpdate(prevProps) {\n      const nextStyleNames = this.getStyleNames(this.props);\n\n      if (\n        prevProps.__theme !== this.props.__theme ||\n        prevProps.style !== this.props.style ||\n        !_.isEqual(this.state.styleNames, nextStyleNames)\n      ) {\n        const style = this.buildStyle(this.props, nextStyleNames);\n        this.setState({ style, styleNames: nextStyleNames });\n      }\n    }\n\n    render() {\n      const { style, __theme, forwardedRef, ...rest } = this.props;\n\n      const refSent = options.withRef && (typeof forwardedRef === 'function' || typeof forwardedRef === 'object') ? forwardedRef : null\n      \n      return (\n        <WrappedComponent\n          {...rest}\n          style={this.state.style}\n          ref={refSent}\n        />\n      );\n    }\n  }\n\n  const StyledWithTheme = React.forwardRef((props, ref) => {\n    return (\n      <StyleContext.Consumer>\n        {theme => (\n          <StyledCore \n            {...props} \n            __theme={theme} \n            forwardedRef={ref}\n          />\n        )}\n      </StyleContext.Consumer>\n    );\n  });\n\n  StyledWithTheme.displayName = `Styled(${\n    WrappedComponent.displayName || WrappedComponent.name || \"Component\"\n  })`;\n\n  return hoistStatics(StyledWithTheme, WrappedComponent);\n};"]}